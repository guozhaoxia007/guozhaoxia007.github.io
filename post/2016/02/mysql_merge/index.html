<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.15" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://guozhaoxia007.github.io/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="http://guozhaoxia007.github.io/index.xml" type="application/rss+xml" title="喵大人">
<title>mysql分表 - 喵大人</title>
</head>
<body>

<header>
  <div class="container">
    <a class="path" href="http://guozhaoxia007.github.io/">[喵大人]</a>
    <span class="caret">Blog</span>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2016-02-24">February 24, 2016</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="http://guozhaoxia007.github.io/categories/mysql">mysql</a>

        <a href="http://guozhaoxia007.github.io/categories/merge">merge</a>

        <a href="http://guozhaoxia007.github.io/categories/oneproxy">oneproxy</a>

    </span>


  </div>
  <h1 class="headline" itemprop="headline">mysql分表</h1>
  <section class="body" itemprop="articleBody">
    

<h4 id="需求:5175bc9dd82baf308939b633d56bbf86">需求</h4>

<ol>
<li>提高插入查询速度</li>
<li>便于归档</li>
</ol>

<h4 id="数据容量估算:5175bc9dd82baf308939b633d56bbf86">数据容量估算</h4>

<p>5k终端，单个终端1分钟4个点，假设1天运行12小时，5000终端1天将产生：4 * 60 * 12 * 5000 = 14400000条记录，一条记录82bytes</p>

<p><strong>即一天产生：14400000 * 82 = 1180800000bytes = 1126.1 M = 1.1 G</strong>
<strong>即一月产生：4亿条记录，30G存储</strong></p>

<p>根据容量估算，除去查询效率不考虑外，单是存储问题就很严重，1w终端单月产生8亿60G，10w终端单月产生80亿600G。</p>

<h4 id="产品调研:5175bc9dd82baf308939b633d56bbf86">产品调研</h4>

<ol>
<li><p>oneproxy</p>

<ul>
<li><p>优点：</p>

<ul>
<li>对应用透明</li>
<li>支持二级分表(tid, timestamp)</li>
<li>多种分表方法(hash, range)</li>
<li>使用简单方便</li>
<li>性能测试，大大提高查询速度，插入速度也不会大的影响</li>
<li>由于使用时间分表，极大方便归档</li>
</ul></li>

<li><p>缺点：</p>

<ul>
<li>需手动创建子表</li>
</ul></li>
</ul></li>

<li><p>mysql merge</p>

<ul>
<li><p>优点：</p>

<ul>
<li>对应用透明</li>
<li>无需引入第三方软件</li>
</ul></li>

<li><p>缺点：</p>

<ul>
<li>子表需为MyISAM引擎</li>
<li>无法使用表字段分表（即无法使用时间分表，只能人工分表）</li>
<li>需手动创建子表</li>
<li>一级分表</li>
<li>MERGE storage engine.  User-defined partitioning and the MERGE storage engine are not compatible.
Tables using the MERGE storage engine cannot be partitioned. Partitioned tables cannot be merged.</li>
</ul></li>
</ul></li>
</ol>

<h4 id="结论:5175bc9dd82baf308939b633d56bbf86">结论</h4>

  </section>
</article>

</main>


</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2016  喵大人 - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

